# CHKN 5-kamp State Machine (v0.1)

## Stages

LOBBY -> YATZY -> BLACKJACK -> ROULETTE -> TRIVIA -> DICE -> MUSIC -> HOLDEM -> RESULTS

## Stage Diagram (text)

[LOBBY]
  on MATCH_CREATED -> LOBBY
  on PLAYER_JOINED -> LOBBY
  on PLAYER_LEFT -> LOBBY
  on READY_CHECK_PASSED -> YATZY

[YATZY]
  on STAGE_STARTED -> YATZY
  on YATZY_SUBMITTED -> YATZY
  on STAGE_COMPLETED -> BLACKJACK

[BLACKJACK]
  on STAGE_STARTED -> BLACKJACK
  on BJ_BET_PLACED -> BLACKJACK
  on BJ_HAND_ACTION -> BLACKJACK
  on BJ_ROUND_COMPLETED -> BLACKJACK
  on STAGE_COMPLETED -> ROULETTE

[ROULETTE]
  on STAGE_STARTED -> ROULETTE
  on ROULETTE_BET_PLACED -> ROULETTE
  on STAGE_COMPLETED -> TRIVIA

[TRIVIA]
  on STAGE_STARTED -> TRIVIA
  on TRIVIA_CATEGORY_PICKED -> TRIVIA
  on TRIVIA_QUESTION_SHOWN -> TRIVIA
  on TRIVIA_ANSWER_SUBMITTED -> TRIVIA
  on TRIVIA_QUESTION_RESOLVED -> TRIVIA
  on STAGE_COMPLETED -> DICE

[DICE]
  on STAGE_STARTED -> DICE
  on DICE_BET_PLACED -> DICE
  on DICE_ROLL_RESOLVED -> DICE
  on STAGE_COMPLETED -> MUSIC

[MUSIC]
  on STAGE_STARTED -> MUSIC
  on MUSIC_CLIP_SHOWN -> MUSIC
  on MUSIC_GUESS_SUBMITTED -> MUSIC
  on MUSIC_ROUND_RESOLVED -> MUSIC
  on STAGE_COMPLETED -> HOLDEM

[HOLDEM]
  on STAGE_STARTED -> HOLDEM
  on HOLDEM_HAND_STARTED -> HOLDEM
  on HOLDEM_ACTION_SUBMITTED -> HOLDEM
  on HOLDEM_HAND_COMPLETED -> HOLDEM
  on HOLDEM_ORBIT_COMPLETED -> HOLDEM
  on STAGE_COMPLETED -> RESULTS

[RESULTS]
  on STAGE_STARTED -> RESULTS
  on MATCH_COMPLETED -> RESULTS

## Stage Gate Rules (server authoritative)

- Endast servern far trigga `STAGE_STARTED` och `STAGE_COMPLETED`.
- Poang/stack far bara uppdateras av servern via `LEDGER_ENTRY_APPLIED`.
- Inga hopp framat mellan stages.

